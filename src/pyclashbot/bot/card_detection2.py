import random


from concurrent.futures import ThreadPoolExecutor, as_completed
from pyclashbot.detection.image_rec import pixel_is_equal

from pyclashbot.memu.client import screenshot

CARD_PIXEL_DATA_DICT = {
    # checked
    "arrows": [
        [
            [78, 63, 175],
            [232, 209, 181],
            [234, 193, 132],
            [234, 190, 143],
            [212, 189, 167],
        ],
        [
            [180, 166, 199],
            [234, 210, 185],
            [232, 190, 140],
            [211, 190, 162],
            [200, 174, 153],
        ],
        [
            [95, 76, 198],
            [235, 211, 183],
            [232, 191, 137],
            [208, 191, 161],
            [197, 173, 149],
        ],
        [
            [133, 107, 197],
            [236, 210, 185],
            [228, 192, 136],
            [209, 189, 159],
            [198, 174, 151],
        ],
        [
            [102, 84, 195],
            [234, 211, 183],
            [228, 185, 135],
            [231, 191, 145],
            [209, 185, 166],
        ],
        [
            [101, 83, 185],
            [234, 211, 183],
            [235, 191, 139],
            [227, 192, 145],
            [211, 185, 169],
        ],
    ],
    "barb_hut": [
        [
            [182, 173, 147],
            [233, 181, 137],
            [239, 220, 225],
            [119, 171, 215],
            [95, 146, 212],
        ],
        [
            [170, 175, 157],
            [222, 174, 127],
            [239, 215, 220],
            [119, 176, 230],
            [100, 157, 232],
        ],
        [
            [174, 167, 143],
            [252, 187, 150],
            [232, 213, 213],
            [107, 155, 233],
            [75, 115, 182],
        ],
        [
            [179, 169, 142],
            [240, 191, 147],
            [234, 214, 218],
            [110, 158, 234],
            [70, 119, 181],
        ],
        [
            [178, 168, 141],
            [248, 190, 145],
            [237, 217, 221],
            [106, 157, 233],
            [67, 115, 179],
        ],
        [
            [178, 169, 142],
            [248, 187, 148],
            [244, 216, 216],
            [110, 160, 231],
            [80, 116, 181],
        ],
    ],
    "barb_barrel": [
        [
            [223, 167, 67],
            [86, 227, 232],
            [56, 81, 121],
            [37, 73, 126],
            [64, 61, 59],
        ],
        [
            [224, 167, 67],
            [68, 237, 238],
            [53, 83, 115],
            [40, 77, 121],
            [65, 60, 59],
        ],
        [
            [225, 167, 69],
            [73, 250, 241],
            [26, 60, 100],
            [49, 83, 132],
            [71, 63, 58],
        ],
    ],
    "balloon": [
        [
            [79, 107, 133],
            [122, 88, 73],
            [88, 102, 107],
            [182, 198, 185],
            [191, 204, 170],
        ],
        [
            [144, 152, 163],
            [115, 87, 73],
            [95, 96, 114],
            [201, 206, 189],
            [184, 199, 164],
        ],
        [
            [90, 113, 148],
            [119, 87, 72],
            [91, 96, 102],
            [187, 201, 189],
            [189, 201, 169],
        ],
        [
            [167, 197, 188],
            [122, 89, 74],
            [90, 93, 98],
            [184, 197, 180],
            [196, 205, 155],
        ],
        [
            [170, 205, 190],
            [124, 91, 71],
            [89, 90, 97],
            [180, 199, 177],
            [198, 203, 153],
        ],
        [
            [167, 203, 191],
            [123, 88, 73],
            [87, 90, 97],
            [186, 201, 179],
            [189, 203, 159],
        ],
    ],
    "bomb_tower": [
        [
            [107, 76, 56],
            [228, 194, 147],
            [28, 40, 82],
            [37, 71, 172],
            [92, 117, 215],
            56,
        ],
        [
            [107, 76, 57],
            [214, 195, 140],
            [28, 39, 81],
            [31, 59, 144],
            [87, 112, 209],
        ],
        [
            [107, 76, 57],
            [220, 194, 139],
            [26, 39, 81],
            [33, 71, 162],
            [86, 115, 210],
        ],
        [
            [107, 76, 57],
            [220, 191, 148],
            [27, 41, 81],
            [38, 64, 154],
            [88, 117, 212],
        ],
    ],
    "battle_ram": [
        [
            [77, 69, 5],
            [206, 190, 168],
            [91, 79, 57],
            [37, 30, 22],
            [29, 35, 72],
        ],
        [
            [74, 71, 4],
            [201, 188, 166],
            [93, 81, 59],
            [37, 30, 22],
            [29, 37, 87],
        ],
        [
            [77, 72, 5],
            [178, 168, 142],
            [89, 77, 55],
            [52, 43, 35],
            [52, 59, 64],
        ],
        [
            [77, 72, 6],
            [182, 185, 157],
            [89, 77, 55],
            [55, 44, 38],
            [53, 60, 82],
        ],
        [
            [81, 72, 8],
            [187, 178, 159],
            [89, 77, 55],
            [56, 46, 33],
            [59, 69, 79],
        ],
    ],
    "cannon": [
        [
            [122, 155, 162],
            [163, 147, 169],
            [53, 58, 58],
            [58, 72, 72],
            [200, 222, 229],
        ],
        [
            [114, 148, 158],
            [175, 143, 148],
            [53, 58, 58],
            [45, 52, 56],
            [200, 223, 231],
        ],
    ],
    "furnace": [
        [
            [68, 115, 89],
            [38, 30, 43],
            [209, 36, 189],
            [144, 135, 127],
            [117, 179, 227],
        ],
        [
            [69, 119, 88],
            [42, 33, 47],
            [213, 41, 189],
            [151, 143, 133],
            [108, 185, 253],
        ],
        [
            [76, 134, 108],
            [34, 30, 48],
            [221, 50, 201],
            [89, 77, 70],
            [104, 179, 232],
        ],
        [
            [70, 120, 95],
            [35, 30, 52],
            [215, 49, 204],
            [87, 79, 69],
            [106, 169, 218],
        ],
        [
            [69, 121, 96],
            [37, 29, 51],
            [217, 47, 200],
            [88, 80, 68],
            [102, 168, 217],
        ],
        [
            [79, 130, 106],
            [41, 31, 50],
            [225, 46, 205],
            [90, 78, 71],
            [100, 177, 231],
        ],
        [
            [76, 126, 100],
            [37, 28, 52],
            [226, 48, 205],
            [84, 77, 69],
            [102, 176, 231],
        ],
        [
            [71, 121, 96],
            [40, 29, 51],
            [218, 47, 203],
            [88, 80, 70],
            [105, 172, 220],
        ],
        [
            [69, 121, 96],
            [37, 30, 49],
            [211, 49, 199],
            [88, 80, 70],
            [107, 169, 216],
        ],
    ],
    "freeze": [
        [
            [243, 229, 184],
            [200, 192, 166],
            [239, 237, 201],
            [239, 228, 30],
            [249, 234, 206],
        ],
        [
            [244, 231, 180],
            [219, 214, 186],
            [249, 247, 205],
            [234, 229, 25],
            [251, 243, 221],
        ],
        [
            [244, 231, 188],
            [239, 232, 204],
            [126, 120, 94],
            [234, 229, 27],
            [234, 228, 223],
        ],
        [
            [245, 231, 190],
            [243, 240, 220],
            [144, 140, 104],
            [237, 229, 30],
            [223, 217, 200],
        ],
        [
            [249, 239, 193],
            [243, 239, 208],
            [104, 101, 61],
            [234, 230, 31],
            [223, 224, 219],
        ],
    ],
    "goblin_drill": [
        [
            [66, 44, 27],
            [103, 82, 63],
            [117, 105, 105],
            [120, 109, 106],
            [84, 56, 37],
        ],
        [
            [67, 46, 25],
            [85, 68, 55],
            [123, 110, 106],
            [120, 108, 107],
            [87, 57, 32],
        ],
    ],
    "goblin_cage": [
        [
            [103, 95, 97],
            [35, 123, 95],
            [44, 161, 138],
            [93, 135, 137],
            [132, 113, 151],
        ],
        [
            [109, 99, 101],
            [36, 119, 94],
            [36, 150, 124],
            [87, 133, 137],
            [158, 119, 133],
        ],
        [
            [106, 98, 99],
            [30, 115, 91],
            [29, 145, 122],
            [99, 136, 140],
            [134, 132, 139],
        ],
    ],
    "graveyard": [
        [
            [99, 83, 91],
            [127, 83, 111],
            [233, 226, 232],
            [98, 61, 78],
            [156, 97, 124],
        ],
        [
            [101, 85, 94],
            [128, 79, 112],
            [231, 225, 233],
            [80, 48, 64],
            [155, 89, 118],
        ],
    ],
    "goblin_barrel": [
        [
            [174, 198, 207],
            [26, 49, 67],
            [42, 138, 141],
            [38, 80, 110],
            [238, 240, 223],
        ],
        [
            [171, 196, 217],
            [30, 50, 73],
            [41, 157, 138],
            [29, 74, 87],
            [236, 242, 222],
        ],
    ],
    "miner": [
        [
            [143, 129, 115],
            [73, 69, 68],
            [25, 24, 36],
            [101, 110, 230],
            [185, 216, 252],
        ],
        [
            [126, 117, 102],
            [73, 70, 64],
            [25, 25, 34],
            [97, 114, 230],
            [184, 217, 251],
        ],
        [
            [101, 87, 71],
            [68, 65, 64],
            [28, 32, 33],
            [102, 120, 239],
            [189, 217, 254],
        ],
    ],
    "skeleton_barrel": [
        [
            [251, 217, 142],
            [254, 217, 150],
            [72, 71, 67],
            [83, 98, 111],
            [45, 82, 131],
        ],
        [
            [255, 213, 147],
            [254, 218, 142],
            [68, 79, 87],
            [119, 135, 167],
            [49, 81, 133],
        ],
        [
            [255, 220, 137],
            [255, 223, 140],
            [68, 72, 81],
            [92, 105, 126],
            [60, 95, 140],
        ],
        [
            [246, 219, 142],
            [250, 220, 151],
            [69, 73, 75],
            [87, 97, 114],
            [60, 89, 137],
        ],
        [
            [255, 214, 144],
            [253, 227, 147],
            [67, 72, 78],
            [97, 105, 127],
            [49, 88, 121],
        ],
        [
            [255, 213, 141],
            [250, 224, 144],
            [67, 72, 78],
            [97, 105, 127],
            [49, 88, 121],
        ],
        [
            [251, 214, 141],
            [252, 226, 146],
            [69, 71, 78],
            [99, 108, 123],
            [55, 89, 123],
        ],
    ],
    "wall_breakers": [
        [
            [81, 107, 147],
            [40, 39, 51],
            [45, 47, 49],
            [176, 176, 145],
            [138, 140, 57],
        ],
        [
            [84, 109, 142],
            [39, 39, 51],
            [49, 51, 53],
            [151, 156, 120],
            [138, 140, 54],
        ],
        [
            [78, 103, 143],
            [94, 87, 89],
            [51, 51, 58],
            [168, 166, 103],
            [136, 137, 52],
        ],
        [
            [75, 97, 139],
            [68, 63, 62],
            [77, 72, 71],
            [137, 134, 87],
            [127, 128, 49],
        ],
        [
            [87, 101, 140],
            [60, 66, 75],
            [66, 69, 69],
            [151, 152, 100],
            [129, 130, 51],
        ],
        [
            [76, 94, 135],
            [45, 42, 49],
            [66, 66, 64],
            [137, 140, 117],
            [128, 132, 52],
        ],
        [
            [89, 95, 143],
            [41, 44, 55],
            [90, 94, 96],
            [166, 174, 82],
            [127, 132, 49],
        ],
        [
            [87, 97, 141],
            [43, 44, 54],
            [92, 93, 98],
            [170, 173, 82],
            [127, 132, 49],
        ],
    ],
    "snowball": [
        [
            [226, 198, 157],
            [249, 236, 199],
            [216, 180, 147],
            [196, 194, 172],
            [120, 74, 41],
        ],
        [
            [221, 188, 141],
            [255, 237, 195],
            [216, 183, 147],
            [196, 192, 169],
            [135, 77, 44],
        ],
        [
            [107, 86, 23],
            [166, 183, 160],
            [144, 153, 97],
            [110, 117, 53],
            [125, 137, 79],
        ],
        [
            [197, 159, 109],
            [248, 227, 187],
            [219, 186, 155],
            [196, 192, 168],
            [134, 82, 47],
        ],
        [
            [195, 157, 107],
            [248, 227, 187],
            [216, 183, 152],
            [196, 192, 168],
            [130, 78, 43],
        ],
        [
            [205, 167, 122],
            [247, 230, 190],
            [218, 181, 147],
            [199, 191, 172],
            [98, 66, 38],
        ],
        [
            [197, 154, 113],
            [250, 231, 186],
            [215, 189, 157],
            [202, 190, 170],
            [142, 74, 45],
        ],
    ],
    "princess": [
        [
            [150, 191, 168],
            [69, 85, 103],
            [64, 73, 107],
            [119, 142, 207],
            [71, 88, 144],
        ],
        [
            [143, 213, 201],
            [62, 82, 100],
            [54, 60, 98],
            [114, 142, 206],
            [67, 87, 132],
        ],
        [
            [150, 175, 130],
            [57, 78, 95],
            [77, 82, 100],
            [103, 134, 197],
            [72, 83, 127],
        ],
        [
            [155, 192, 166],
            [57, 79, 99],
            [35, 49, 63],
            [109, 135, 205],
            [67, 81, 129],
        ],
        [
            [173, 163, 102],
            [102, 127, 141],
            [117, 122, 149],
            [101, 131, 190],
            [51, 54, 91],
        ],
        [
            [143, 159, 111],
            [109, 117, 139],
            [121, 138, 168],
            [104, 129, 196],
            [55, 61, 97],
        ],
        [
            [140, 160, 109],
            [107, 115, 137],
            [119, 139, 168],
            [110, 136, 200],
            [56, 59, 96],
        ],
    ],
    "tombstone": [
        [
            [102, 85, 20],
            [184, 217, 187],
            [148, 150, 105],
            [104, 115, 55],
            [128, 142, 79],
        ],
        [
            [104, 83, 20],
            [173, 198, 180],
            [135, 150, 101],
            [99, 116, 54],
            [130, 140, 77],
        ],
        [
            [104, 88, 25],
            [107, 127, 115],
            [187, 194, 145],
            [110, 123, 62],
            [147, 162, 108],
        ],
        [
            [101, 87, 26],
            [147, 156, 114],
            [170, 186, 129],
            [105, 118, 64],
            [141, 158, 115],
        ],
        [
            [105, 87, 24],
            [139, 168, 148],
            [160, 169, 120],
            [107, 117, 64],
            [143, 159, 97],
        ],
    ],
    "royal_delivery": [
        [
            [184, 173, 161],
            [70, 131, 226],
            [59, 101, 152],
            [61, 101, 163],
            [121, 100, 87],
        ],
        [
            [127, 113, 99],
            [75, 141, 236],
            [71, 115, 170],
            [56, 92, 153],
            [118, 104, 93],
        ],
        [
            [146, 132, 122],
            [61, 129, 223],
            [59, 104, 153],
            [61, 98, 161],
            [118, 100, 86],
        ],
        [
            [163, 148, 143],
            [60, 121, 215],
            [63, 105, 155],
            [58, 97, 162],
            [121, 100, 87],
        ],
        [
            [117, 110, 95],
            [75, 142, 239],
            [29, 64, 122],
            [69, 104, 176],
            [118, 98, 88],
        ],
        [
            [117, 110, 89],
            [75, 142, 239],
            [26, 61, 119],
            [69, 104, 176],
            [120, 100, 90],
        ],
        [
            [115, 111, 89],
            [77, 141, 239],
            [26, 61, 119],
            [70, 105, 177],
            [115, 97, 87],
        ],
        [
            [166, 158, 158],
            [63, 129, 235],
            [7, 52, 105],
            [59, 98, 177],
            [120, 98, 86],
        ],
    ],
    "hog": [
        [
            [57, 129, 196],
            [45, 38, 64],
            [26, 29, 53],
            [17, 17, 33],
            [63, 115, 142],
        ],
        [
            [59, 126, 192],
            [57, 49, 66],
            [25, 28, 53],
            [13, 14, 25],
            [73, 130, 161],
        ],
        [
            [44, 108, 159],
            [32, 30, 52],
            [26, 31, 49],
            [7, 7, 14],
            [121, 154, 177],
        ],
        [
            [46, 124, 193],
            [56, 52, 78],
            [34, 38, 60],
            [25, 25, 33],
            [44, 68, 111],
        ],
        [
            [42, 95, 146],
            [20, 27, 38],
            [17, 27, 39],
            [0, 2, 22],
            [115, 92, 64],
        ],
        [
            [41, 93, 148],
            [21, 28, 39],
            [18, 27, 42],
            [0, 2, 22],
            [120, 95, 67],
        ],
        [
            [44, 97, 150],
            [20, 27, 38],
            [17, 27, 39],
            [0, 2, 22],
            [117, 92, 64],
        ],
    ],
    "earthquake": [
        [
            [74, 80, 55],
            [70, 77, 65],
            [22, 46, 54],
            [98, 150, 171],
            [37, 54, 73],
        ],
        [
            [74, 80, 55],
            [67, 77, 60],
            [53, 77, 83],
            [84, 121, 146],
            [39, 54, 74],
        ],
        [
            [74, 79, 56],
            [68, 77, 65],
            [40, 65, 71],
            [71, 106, 135],
            [41, 54, 70],
        ],
        [
            [74, 79, 56],
            [68, 77, 63],
            [44, 65, 69],
            [71, 105, 137],
            [41, 55, 69],
        ],
        [
            [72, 80, 54],
            [66, 78, 65],
            [32, 47, 50],
            [86, 131, 153],
            [34, 52, 66],
        ],
        [
            [74, 79, 54],
            [67, 79, 66],
            [29, 44, 47],
            [86, 131, 153],
            [38, 56, 70],
        ],
    ],
    "mortar": [
        [
            [228, 205, 186],
            [148, 133, 113],
            [128, 91, 36],
            [89, 93, 95],
            [153, 154, 152],
        ],
        [
            [224, 210, 187],
            [121, 109, 99],
            [124, 89, 34],
            [82, 79, 80],
            [173, 178, 178],
        ],
        [
            [220, 213, 180],
            [131, 120, 100],
            [125, 95, 34],
            [84, 87, 88],
            [158, 161, 162],
        ],
        [
            [222, 206, 177],
            [184, 170, 150],
            [123, 93, 32],
            [132, 140, 139],
            [133, 135, 128],
        ],
        [
            [227, 207, 177],
            [183, 158, 151],
            [126, 95, 37],
            [225, 223, 219],
            [136, 141, 124],
        ],
        [
            [217, 203, 183],
            [182, 168, 134],
            [141, 95, 35],
            [168, 172, 174],
            [94, 141, 168],
        ],
        [
            [217, 203, 183],
            [182, 168, 134],
            [141, 95, 35],
            [168, 174, 169],
            [94, 141, 168],
        ],
    ],
    "log": [
        [
            [192, 213, 198],
            [67, 113, 158],
            [13, 36, 62],
            [14, 49, 69],
            [60, 88, 96],
        ],
        [
            [177, 213, 206],
            [74, 126, 173],
            [9, 36, 64],
            [16, 47, 70],
            [55, 81, 98],
        ],
        [
            [166, 203, 190],
            [74, 129, 175],
            [12, 37, 66],
            [15, 47, 67],
            [59, 84, 99],
        ],
        [
            [162, 230, 219],
            [78, 131, 179],
            [9, 35, 61],
            [14, 42, 67],
            [54, 89, 99],
        ],
        [
            [201, 188, 177],
            [85, 138, 182],
            [10, 32, 56],
            [17, 52, 71],
            [218, 223, 229],
        ],
        [
            [196, 189, 174],
            [86, 137, 181],
            [10, 31, 57],
            [16, 50, 72],
            [221, 226, 232],
        ],
        [
            [199, 194, 161],
            [100, 134, 181],
            [0, 35, 58],
            [20, 47, 75],
            [217, 218, 213],
        ],
        [
            [197, 189, 163],
            [100, 135, 180],
            [0, 36, 59],
            [20, 49, 77],
            [216, 217, 212],
        ],
        [
            [189, 195, 162],
            [100, 135, 180],
            [0, 35, 58],
            [24, 53, 81],
            [221, 222, 217],
        ],
    ],
    "tesla": [
        [
            [162, 98, 43],
            [180, 117, 60],
            [111, 75, 59],
            [76, 78, 103],
            [93, 123, 214],
        ],
        [
            [164, 98, 43],
            [186, 122, 67],
            [110, 79, 73],
            [44, 75, 132],
            [103, 134, 208],
        ],
        [
            [162, 97, 45],
            [181, 118, 61],
            [110, 71, 54],
            [104, 108, 156],
            [89, 126, 214],
        ],
        [
            [165, 98, 46],
            [180, 118, 59],
            [98, 68, 47],
            [87, 97, 131],
            [95, 129, 221],
        ],
    ],
    "poison": [
        [
            [1, 21, 69],
            [41, 101, 234],
            [116, 149, 240],
            [120, 134, 250],
            [44, 124, 222],
        ],
        [
            [0, 20, 68],
            [42, 107, 234],
            [114, 147, 240],
            [100, 116, 248],
            [44, 120, 219],
        ],
        [
            [1, 19, 67],
            [39, 110, 222],
            [107, 140, 243],
            [147, 174, 255],
            [38, 120, 221],
        ],
        [
            [2, 19, 69],
            [47, 103, 223],
            [124, 154, 239],
            [114, 131, 248],
            [33, 109, 211],
        ],
        [
            [2, 18, 71],
            [53, 106, 216],
            [114, 147, 236],
            [24, 39, 226],
            [28, 114, 216],
        ],
        [
            [4, 20, 66],
            [42, 107, 231],
            [85, 126, 225],
            [108, 170, 254],
            [61, 135, 231],
        ],
        [
            [4, 19, 69],
            [40, 107, 219],
            [121, 150, 231],
            [99, 115, 255],
            [59, 133, 223],
        ],
        [
            [2, 19, 69],
            [45, 115, 236],
            [21, 83, 201],
            [39, 149, 248],
            [59, 162, 255],
        ],
    ],
    "royal_hogs": [
        [
            [118, 65, 3],
            [78, 67, 62],
            [164, 161, 160],
            [78, 68, 120],
            [65, 40, 16],
        ],
        [
            [116, 71, 8],
            [75, 67, 61],
            [175, 170, 169],
            [55, 55, 96],
            [61, 42, 11],
        ],
    ],
    "ram_rider": [
        [
            [117, 199, 231],
            [121, 238, 253],
            [26, 79, 132],
            [125, 109, 114],
            [110, 141, 200],
        ],
        [
            [109, 207, 234],
            [116, 237, 252],
            [35, 96, 140],
            [106, 106, 126],
            [104, 141, 190],
        ],
        [
            [120, 204, 223],
            [117, 237, 253],
            [53, 117, 164],
            [117, 112, 127],
            [108, 134, 173],
        ],
        [
            [130, 214, 239],
            [120, 235, 253],
            [44, 114, 161],
            [123, 121, 136],
            [107, 133, 179],
        ],
        [
            [100, 201, 227],
            [123, 238, 255],
            [24, 76, 134],
            [119, 112, 118],
            [100, 150, 200],
        ],
    ],
    "inferno_tower": [
        [
            [65, 84, 249],
            [102, 57, 94],
            [139, 151, 231],
            [113, 115, 169],
            [204, 158, 192],
        ],
        [
            [58, 98, 242],
            [103, 57, 103],
            [127, 148, 223],
            [117, 116, 165],
            [171, 128, 186],
        ],
        [
            [69, 97, 244],
            [112, 62, 99],
            [144, 137, 224],
            [114, 120, 176],
            [142, 105, 159],
        ],
        [
            [58, 94, 237],
            [103, 59, 93],
            [143, 141, 226],
            [112, 115, 175],
            [157, 120, 174],
        ],
    ],
    "goblin_hut": [
        [
            [223, 204, 133],
            [61, 108, 190],
            [106, 160, 200],
            [3, 10, 43],
            [17, 41, 85],
        ],
        [
            [221, 204, 135],
            [43, 77, 172],
            [120, 175, 214],
            [0, 8, 48],
            [16, 44, 89],
        ],
        [
            [222, 202, 137],
            [41, 84, 171],
            [96, 153, 195],
            [0, 9, 46],
            [19, 53, 97],
        ],
    ],
    "lightning": [
        [
            [225, 177, 142],
            [253, 235, 223],
            [166, 117, 101],
            [233, 111, 38],
            [180, 89, 42],
        ],
        [
            [221, 171, 125],
            [248, 236, 228],
            [151, 101, 84],
            [237, 112, 36],
            [194, 85, 33],
        ],
        [
            [224, 174, 135],
            [252, 236, 229],
            [160, 116, 100],
            [230, 113, 35],
            [179, 81, 26],
        ],
    ],
    "rocket": [
        [
            [236, 232, 220],
            [160, 164, 173],
            [155, 181, 198],
            [137, 223, 250],
            [62, 193, 226],
        ],
        [
            [236, 234, 217],
            [146, 152, 161],
            [158, 181, 200],
            [138, 226, 246],
            [44, 178, 220],
        ],
        [
            [237, 235, 218],
            [123, 129, 138],
            [150, 174, 192],
            [145, 228, 255],
            [37, 162, 204],
        ],
        [
            [231, 235, 214],
            [147, 153, 162],
            [149, 174, 193],
            [148, 231, 246],
            [45, 175, 205],
        ],
    ],
    "xbow": [
        [
            [202, 195, 174],
            [181, 180, 153],
            [120, 143, 167],
            [122, 138, 126],
            [89, 186, 159],
        ],
        [
            [189, 188, 190],
            [172, 172, 172],
            [151, 151, 151],
            [131, 131, 131],
            [167, 167, 167],
        ],
        [
            [207, 199, 178],
            [180, 181, 160],
            [206, 196, 196],
            [132, 159, 146],
            [95, 183, 155],
        ],
        [
            [188, 188, 164],
            [172, 184, 155],
            [171, 175, 184],
            [139, 167, 152],
            [98, 175, 156],
        ],
        [
            [196, 192, 168],
            [181, 180, 153],
            [180, 175, 176],
            [131, 166, 151],
            [84, 179, 151],
        ],
        [
            [196, 192, 170],
            [182, 182, 153],
            [180, 175, 176],
            [133, 168, 153],
            [79, 177, 148],
        ],
    ],
    "rage": [
        [
            [249, 169, 242],
            [241, 179, 240],
            [227, 182, 224],
            [123, 17, 96],
            [233, 185, 238],
        ],
        [
            [249, 181, 246],
            [239, 192, 239],
            [224, 178, 220],
            [115, 11, 88],
            [224, 147, 220],
        ],
        [
            [249, 173, 248],
            [227, 174, 221],
            [228, 183, 224],
            [122, 12, 95],
            [226, 181, 234],
        ],
        [
            [250, 177, 245],
            [241, 189, 241],
            [225, 181, 231],
            [123, 14, 94],
            [219, 170, 221],
        ],
        [
            [239, 169, 233],
            [255, 212, 255],
            [99, 49, 96],
            [122, 15, 96],
            [220, 202, 239],
        ],
        [
            [236, 166, 237],
            [255, 211, 255],
            [99, 53, 93],
            [123, 15, 99],
            [220, 202, 239],
        ],
        [
            [237, 170, 233],
            [255, 211, 255],
            [97, 51, 91],
            [122, 15, 96],
            [218, 202, 239],
        ],
        [
            [249, 150, 240],
            [255, 216, 255],
            [92, 61, 91],
            [127, 21, 100],
            [217, 214, 244],
        ],
    ],
    "zap": [
        [
            [147, 115, 54],
            [186, 162, 108],
            [185, 96, 42],
            [148, 87, 44],
            [150, 89, 33],
        ],
        [
            [146, 118, 53],
            [190, 165, 110],
            [210, 142, 94],
            [209, 134, 62],
            [146, 84, 32],
        ],
        [
            [144, 111, 57],
            [183, 160, 108],
            [165, 106, 69],
            [156, 78, 1],
            [149, 95, 39],
        ],
        [
            [145, 115, 54],
            [190, 165, 108],
            [224, 143, 91],
            [170, 114, 64],
            [145, 84, 27],
        ],
        [
            [155, 124, 66],
            [191, 169, 118],
            [206, 160, 108],
            [189, 160, 102],
            [158, 84, 33],
        ],
        [
            [153, 126, 63],
            [192, 170, 119],
            [207, 158, 107],
            [192, 163, 105],
            [153, 78, 29],
        ],
        [
            [155, 124, 66],
            [191, 170, 117],
            [208, 159, 108],
            [189, 161, 100],
            [152, 78, 27],
        ],
        [
            [152, 115, 60],
            [191, 166, 109],
            [224, 165, 118],
            [202, 119, 48],
            [145, 83, 30],
        ],
    ],
}


PLAY_COORDS = {
    # done
    "spell": {
        "left": [(116, 140)],
        "right": [(302, 140)],
    },
    "hog": {
        "left": [(77, 281), (113, 286), (154, 283)],
        "right": [(257, 283), (300, 284), (353, 283)],
    },
    "turret": {
        "left": [(224, 300), (224, 334)],
        "right": [(224, 300), (224, 334)],
    },
    "miner": {
        "left": [(86, 156), (90, 104), (143, 113), (142, 153)],
        "right": [(274, 152), (276, 111), (339, 111), (323, 157)],
    },
    "goblin_barrel": {
        "left": [(115, 134), (115, 134), (60, 96)],
        "right": [(300, 137), (300, 137), (356, 106)],
    },
    "xbow": {
        "left": [(170, 288)],
        "right": [(254, 284)],
    },
    "spawner": {
        "left": [(69, 442), (158, 444), (166, 394)],
        "right": [(247, 396), (264, 440), (343, 442)],
    },
}


def get_play_coords_for_card(vm_index, card_index, side_preference):
    card_data = get_all_card_pixel_data(vm_index)[card_index]

    # get the ID of this card(ram_rider, zap, etc)
    identity = identify_card(card_data)

    # get the grouping of this card (hog, turret, spell, etc)
    group = get_card_group(identity)

    # get the play coords of this grouping
    coords = calculate_play_coords(group, side_preference)

    return identity, coords


def get_card_group(card_id) -> str:
    card_groups: dict[str, list[str]] = {
        "spell": [
            "earthquake",
            "fireball",
            "freeze",
            "poison",
            "arrows",
            "snowball",
            "zap",
            "rocket",
            "lightning",
            "log",
            "tornado",
            "graveyard",
        ],
        "turret": [
            "bomb_tower",
            "cannon",
            "tesla",
            "goblin_cage",
            "inferno_tower",
        ],
        "hog": [
            "battle_ram",
            "wall_breakers",
            "princess",
            "ram_rider",
            "skeleton_barrel",
            "hog",
            "royal_hogs",
        ],
        "miner": [
            "goblin_drill",
            "miner",
        ],
        "goblin_barrel": [
            "goblin_barrel",
        ],
        "xbow": [
            "xbow",
            "mortar",
        ],
        "spawner": [
            "tombstone",
            "goblin_hut",
            "barb_hut",
            "furnace",
        ],
    }

    for group, cards in card_groups.items():
        if card_id in cards:
            return group

    return "No group"


def calculate_play_coords(card_grouping: str, side_preference: str):
    if PLAY_COORDS.get(card_grouping):
        group_datum = PLAY_COORDS[card_grouping]
        if side_preference == "left" and "left" in group_datum:
            return random.choice(group_datum["left"])
        if side_preference == "right" and "right" in group_datum:
            return random.choice(group_datum["right"])
        if "coords" in group_datum:
            return random.choice(group_datum["coords"])

    if side_preference == "left":
        return (random.randint(60, 206), random.randint(281, 456))
    return (random.randint(210, 351), random.randint(281, 456))


def get_all_card_pixel_data(vm_index):
    iar = screenshot(vm_index)
    base_coord_list = [
        [121, 537],
        [130, 547],
        [140, 557],
        [150, 567],
        [160, 576],
    ]

    pixel_lists = []

    for card_index in range(4):
        this_pixel_list = []
        for coord in base_coord_list:
            x = coord[0] + (card_index * 66.6)
            x = int(x)
            y = coord[1]
            this_pixel_list.append(iar[y][x])
        pixel_lists.append(this_pixel_list)

    return pixel_lists


def compare_card_pixels(seen_pixel_data, sentinel_pixel_data):
    for index, seen_pixel in enumerate(seen_pixel_data):
        sentinel_pixel = sentinel_pixel_data[index]
        if not pixel_is_equal(seen_pixel, sentinel_pixel, tol=15):
            return False
    return True


def check_pixel(card_name: str, color_list, card_data) -> str | None:
    if compare_card_pixels(card_data, color_list):
        return card_name.replace("_lists", "")
    return None


def identify_card(card_data):
    max_workers = len(CARD_PIXEL_DATA_DICT)
    with ThreadPoolExecutor(
        max_workers=max_workers, thread_name_prefix="CardIdentifier"
    ) as executor:
        futures = [
            executor.submit(check_pixel, card_name, color_list, card_data)
            for card_name, card_pixel_lists in CARD_PIXEL_DATA_DICT.items()
            for color_list in card_pixel_lists
        ]

        for future in as_completed(futures):
            result = future.result()
            if result is not None:
                return result
        return "unknown"


def print_pixel_data(vm_index, card_index):
    data = get_all_card_pixel_data(vm_index)
    pix_list = data[card_index]
    for p in pix_list:
        print(f"[{p[0]},{p[1]},{p[2]}],")


def card_detection_tester(vm_index):
    print("\n\n--------------")
    card_data = get_all_card_pixel_data(vm_index)
    for i, d in enumerate(card_data):
        identification = identify_card(d)
        print(identification)
        if identification == "unknown":
            print(f"Card index #{i} failed")
            for p in d:
                print(f"[{p[0]},{p[1]},{p[2]}],")
        print("--------------")


if __name__ == "__main__":
    # right tower arrows = 292,146
    # left tower arrows = 116,149

    coord = ()
    from pyclashbot.memu.client import click

    click(12, coord[0], coord[1])
